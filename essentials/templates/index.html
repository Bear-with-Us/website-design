{% extends 'base.html' %}

{% block body %}
<nav class="navbar navbar-expand-lg navbar-light py-4 py-lg-0 fixed-top bg-white bg-opacity-75 border-bottom" style="">
	<div class="container"><a class="navbar-brand font-serif text-uppercase h6 text-primary fw-bold mb-0">共振幻想3.0</a>
		<button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
		<div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="nav navbar-nav ms-auto mb-2 mb-lg-0">
				<li class="nav-item"><a class="nav-link text-uppercase" href="#intro">TOP</a></li>
				<!-- <li class="nav-item"><a class="nav-link text-uppercase" href="#about">活动详情</a></li> -->
				<li class="nav-item"><a class="nav-link text-uppercase" href="#apply">报名</a></li>
				<!-- <li class="nav-item"><a class="nav-link text-uppercase" href="#map">地图</a></li> -->
				</li>
			</ul>
		</div>
	</div>
</nav>
<!-- INTRO SECTION-->
<section class="intro bg-cover bg-center d-flex align-items-center dark-overlay" id="intro">
	<div class="parallax" style="background-image: url('{{ url_for('static', filename='image/底图.png') }}'); height: 799.222px; top: -496.444px;"></div>
	<div class="overlay-content text-white w-100">
		<div class="container text-center">
			<div class="row">
				<div class="col-lg-11 mx-auto">

					<h1 class="intro-heading my-5 wow fadeInDown" data-wow-delay="0s" style="visibility: visible; animation-delay: 0s; animation-name: fadeInDown;"><img src="{{ url_for('static',filename="image/云雾LOGO.png") }}" alt="title1" style="max-width: 100%;">
					</h1>

					<p class="h3 intro-text fw-normal wow fadeInUp" data-wow-delay="0.5s" style="visibility: visible; animation-delay: 0.5s; animation-name: fadeInUp;"><img src="{{ url_for('static',filename="image/骰子.png") }}" alt="title2" style="max-width: 100%;margin-top:-20%"></p>
					<p class="h3 intro-text fw-normal wow fadeInUp" data-wow-delay="0.5s" style="visibility: visible; animation-delay: 0.5s; animation-name: fadeInUp;"><img src="{{ url_for('static',filename="image/杂锅.png") }}" alt="title2" style="max-width: 120%;margin-top:-20%"></p>

				</div>
			</div>
		</div>
	</div>
</section>
<!--  /- END INTRO SECTION-->
<!-- ABOUT SECTION -->
<!-- <section id="about" class="bg-gray-800 text-white">
	<div class="container">
		<header class="mb-5 text-center">
			<h2 class="heading">活动详情</h2>
		</header>
		<div class="row gy-4">
			<div class="col-lg-6 wow fadeInUp" data-wow-delay="0s">
				<p><strong>活动时间：</strong>2024年5月2日 10:00 - 22:00</p>
				<p><strong>活动地点：</strong>重庆市渝中区印象城6Lcoptus卡普塔斯卡牌桌游体验馆（高德美团均可直接搜到）</p>
				<p><strong>交通：</strong>
				<ul>
					<li>推荐：轨道九号线化龙桥站，地铁站在商场内部，可直接进入印象城4L</li>
					<li>瑞天路·铭依眼科站（501路，261路，808路，503路，210路），步行436米至印象城</li>
					<li>华村站（318路）步行558米至印象城</li>
					<li>印象城停车位价格：<ul>
							<li>4 RMB/H</li>
							<li>15 RMB/12H</li>
							<li>25 RMB/24H</li>
						</ul>
					</li>
					<li>充电桩位置：B1,B2,B3的A区</li>
				</ul>
				</p>
				<p><strong>主办方QQ：</strong>734222469</p>
				<p><strong>主办方微信：</strong>734222469</p>
			</div>
			<div class="col-lg-3 col-md-6 wow fadeInUp text-center" data-wow-delay="0.1s">
				<img src="img/qq.png" alt="QQ二维码" style="max-width: 100%;" />
			</div>
			<div class="col-lg-3 col-md-6 wow fadeInUp text-center" data-wow-delay="0.2s">
				<img src="img/wechat.png" alt="微信二维码" style="max-width: 100%;" />
			</div>
		</div>
	</div>
</section> -->

<!--Sponsorship-->
<section class="bg-gray-800 text-white py-2">
	<div class="container">
		<header class="text-center">
			<h2 class="heading">活动赞助商</h2>
		</header>
		<div class="row">
			<div class="col-12 col-lg-6">
				<div id="sponsor1" class="carousel slide pointer-event" data-bs-ride="carousel">
					<div class="carousel-indicators">
						<button type="button" data-bs-target="#sponsor1" data-bs-slide-to="0" class="" aria-label="Slide 1"></button>
						<button type="button" data-bs-target="#sponsor1" data-bs-slide-to="1" aria-label="Slide 2" class=""></button>
						<button type="button" data-bs-target="#sponsor1" data-bs-slide-to="2" aria-label="Slide 3" class="active" aria-current="true"></button>
					</div>
					<div class="carousel-inner">
						<div class="carousel-item" data-bs-interval="3000">
							<img src="{{ url_for('static',filename="image/广告/1-1.webp") }}" class="d-block w-100" alt="银钥秘社">
						</div>
						<div class="carousel-item" data-bs-interval="3000">
							<img src="{{ url_for('static',filename="image/广告/1-2.webp") }}" class="d-block w-100" alt="银钥秘社">
						</div>
						<div class="carousel-item active" data-bs-interval="3000">
							<img src="{{ url_for('static',filename="image/广告/1-3.webp") }}" class="d-block w-100" alt="银钥秘社">
						</div>
					</div>
					<button class="carousel-control-prev" type="button" data-bs-target="#sponsor1" data-bs-slide="prev">
						<span class="carousel-control-prev-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Previous</span>
					</button>
					<button class="carousel-control-next" type="button" data-bs-target="#sponsor1" data-bs-slide="next">
						<span class="carousel-control-next-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Next</span>
					</button>
				</div>
			</div>
			<div class="col-12 col-lg-6">
				<div id="sponsor2" class="carousel slide pointer-event" data-bs-ride="carousel">
					<div class="carousel-indicators">
						<button type="button" data-bs-target="#sponsor2" data-bs-slide-to="0" class="" aria-label="Slide 1"></button>
						<button type="button" data-bs-target="#sponsor2" data-bs-slide-to="1" aria-label="Slide 2" class="active" aria-current="true"></button>
						<button type="button" data-bs-target="#sponsor2" data-bs-slide-to="2" aria-label="Slide 3" class=""></button>
					</div>
					<div class="carousel-inner">
						<div class="carousel-item" data-bs-interval="3000">
							<img src="{{ url_for('static',filename="image/广告/2-1.webp") }}" class="d-block w-100" alt="吟游之歌">
						</div>
						<div class="carousel-item active" data-bs-interval="3000">
							<img src="{{ url_for('static',filename="image/广告/2-2.webp") }}" class="d-block w-100" alt="吟游之歌">
						</div>
						<div class="carousel-item" data-bs-interval="3000">
							<img src="{{ url_for('static',filename="image/广告/2-3.webp") }}" class="d-block w-100" alt="吟游之歌">
						</div>
					</div>
					<button class="carousel-control-prev" type="button" data-bs-target="#sponsor2" data-bs-slide="prev">
						<span class="carousel-control-prev-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Previous</span>
					</button>
					<button class="carousel-control-next" type="button" data-bs-target="#sponsor2" data-bs-slide="next">
						<span class="carousel-control-next-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Next</span>
					</button>
				</div>
			</div>
		</div>
	</div>
</section>


<!-- display game list -->
<!-- display game list -->
<section id="apply" style="background-color: var(--color-bg);">
    <div class="container text-center">
        <!-- Only login/user info changes dynamically -->
        <div id="dynamic-content">Loading...</div>

        <!-- Game tabs and listing remain static -->
        <div id="game-tabs-container" class="mt-4">
            <!-- Game tabs and content here -->
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item me-3" role="presentation">
                    <button class="nav-link" id="day1-tab" data-bs-toggle="tab" data-bs-target="#day1-content" type="button" role="tab" aria-controls="day1-content" aria-selected="false">5月31号团</button>
                </li>
                <li class="nav-item me-3" role="presentation">
                    <button class="nav-link active" id="day2-tab" data-bs-toggle="tab" data-bs-target="#day2-content" type="button" role="tab" aria-controls="day2-content" aria-selected="true">6月1号团</button>
                </li>
            </ul>

            <div class="tab-content" id="myTabContent">
                <!-- Day 1 tab content -->
                <div class="tab-pane fade" id="day1-content" role="tabpanel" aria-labelledby="day1-tab">
                    <details style="text-align: left;" open="">
                        <summary style="line-height:3em;">上半场</summary>
                        <div class="row">
                            {% for game in day1_gamesA %}
                                <div class="equal-height h-auto mb-3 col-xl-6 bg-white p-4 position-relative">
                                    <div class="row">
                                        <div style="width: calc(100% - 140px);" class="position-relative">
                                            <div class="text-lg position-absolute top-0 end-0 opacity-25 text-gray-500" id="signed_{{ game.id }}" style="transform: rotate(20deg);display: none;">
                                                <strong>已报名</strong>
                                            </div>
                                            <p class="mb-2 text-gray-500 text-start">
                                                <strong style="font-size: 1.5rem;" class="text-primary">【{{ game.rule }}】{{ game.name }}</strong><br>
                                                <strong>主持：</strong>{{ game.kp }}<br>
                                                <strong>场次：</strong>上半场<br>
                                            </p>
                                            <p class="mb-0 text-gray-500 text-start">
                                                剩余空位：<strong class="text-primary text-lg">{{ game.max_pl-space_reserved[game.id] }}</strong>
                                            </p>
                                            <div class="position-absolute bottom-0 end-0">
                                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal_{{ game.id }}">详情</button>
                                            </div>
                                        </div>
                                        <div class="overflow-hidden" style="width: 140px; height: 180px;">
                                            <img src="{{ url_for('static', filename='image/' ~ game.theme) }}" alt="" class="h-100 w-100 object-fit-cover">
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade text-start" id="modal_{{ game.id }}" tabindex="-1" aria-labelledby="myModalLabel" style="display: none;" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="myModalLabel">{{ game.name }}</h5>
                                                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="card-body p-4">
                                                <strong>规则：</strong><br>{{ game.rule }}<br><br>
                                                <strong>背景介绍：</strong><br>{{ game.description }}<br><br>
                                                <strong>QQ：</strong>{{ game.qq }}<br><br>
                                                <strong>跑团桌位：</strong>{{ game.table }}
                                            </div>
                                            <div class="modal-footer">
												{% if game.id in enrolled_game %}
												<a class="btn btn-primary" style="display: block;" href="{{ url_for('remove_player', game_id=game.id) }}" onclick="return handleGameAction(this)">取消报名</a>
												<a class="btn btn-primary" style="display: none;" href="{{ url_for('add_player', game_id=game.id) }}" onclick="return handleGameAction(this)">报名</a>
												{% else %}
												<a class="btn btn-primary" style="display: none;" href="{{ url_for('remove_player', game_id=game.id) }}" onclick="return handleGameAction(this)">取消报名</a>
												<a class="btn btn-primary" style="display: block;" href="{{ url_for('add_player', game_id=game.id) }}" onclick="return handleGameAction(this)">报名</a>
												{% endif %}
											</div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </details>
                    <details style="text-align: left;" open="">
                        <summary style="line-height:3em;">下半场</summary>
                        <div class="row">
                            {% for game in day1_gamesB %}
                                <div class="equal-height h-auto mb-3 col-xl-6 bg-white p-4 position-relative">
                                    <div class="row">
                                        <div style="width: calc(100% - 140px);" class="position-relative">
                                            <div class="text-lg position-absolute top-0 end-0 opacity-25 text-gray-500" id="signed_{{ game.id }}" style="transform: rotate(20deg);display: none;">
                                                <strong>已报名</strong>
                                            </div>
                                            <p class="mb-2 text-gray-500 text-start">
                                                <strong style="font-size: 1.5rem;" class="text-primary">【{{ game.rule }}】{{ game.name }}</strong><br>
                                                <strong>主持：</strong>{{ game.kp }}<br>
                                                <strong>场次：</strong>下半场<br>
                                            </p>
                                            <p class="mb-0 text-gray-500 text-start">
                                                剩余空位：<strong class="text-primary text-lg">{{ game.max_pl-space_reserved[game.id] }}</strong>
                                            </p>
                                            <div class="position-absolute bottom-0 end-0">
                                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal_{{ game.id }}">详情</button>
                                            </div>
                                        </div>
                                        <div class="overflow-hidden" style="width: 140px; height: 180px;">
                                            <img src="{{ url_for('static', filename='image/' ~ game.theme) }}" alt="" class="h-100 w-100 object-fit-cover">
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade text-start" id="modal_{{ game.id }}" tabindex="-1" aria-labelledby="myModalLabel" style="display: none;" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="myModalLabel">{{ game.name }}</h5>
                                                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="card-body p-4">
                                                <strong>规则：</strong><br>{{ game.rule }}<br><br>
                                                <strong>背景介绍：</strong><br>{{ game.description }}<br><br>
                                                <strong>QQ：</strong>{{ game.qq }}<br><br>
                                                <strong>跑团桌位：</strong>{{ game.table }}
                                            </div>
                                            <div class="modal-footer">
												{% if game.id in enrolled_game %}
												<a class="btn btn-primary" style="display: block;" href="{{ url_for('remove_player', game_id=game.id) }}" onclick="return handleGameAction(this)">取消报名</a>
												<a class="btn btn-primary" style="display: none;" href="{{ url_for('add_player', game_id=game.id) }}" onclick="return handleGameAction(this)">报名</a>
												{% else %}
												<a class="btn btn-primary" style="display: none;" href="{{ url_for('remove_player', game_id=game.id) }}" onclick="return handleGameAction(this)">取消报名</a>
												<a class="btn btn-primary" style="display: block;" href="{{ url_for('add_player', game_id=game.id) }}" onclick="return handleGameAction(this)">报名</a>
												{% endif %}
											</div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </details>
                </div>

                <!-- Day 2 tab content -->
                <div class="tab-pane fade show active" id="day2-content" role="tabpanel" aria-labelledby="day2-tab">
                    <details style="text-align: left;" open="">
                        <summary style="line-height:3em;">上半场</summary>
                        <div class="row">
                            {% for game in day2_gamesA %}
                                <div class="equal-height h-auto mb-3 col-xl-6 bg-white p-4 position-relative">
                                    <div class="row">
                                        <div style="width: calc(100% - 140px);" class="position-relative">
                                            <div class="text-lg position-absolute top-0 end-0 opacity-25 text-gray-500" id="signed_{{ game.id }}" style="transform: rotate(20deg);display: none;">
                                                <strong>已报名</strong>
                                            </div>
                                            <p class="mb-2 text-gray-500 text-start">
                                                <strong style="font-size: 1.5rem;" class="text-primary">【{{ game.rule }}】{{ game.name }}</strong><br>
                                                <strong>主持：</strong>{{ game.kp }}<br>
                                                <strong>场次：</strong>上半场<br>
                                            </p>
                                            <p class="mb-0 text-gray-500 text-start">
                                                剩余空位：<strong class="text-primary text-lg">{{ game.max_pl-space_reserved[game.id] }}</strong>
                                            </p>
                                            <div class="position-absolute bottom-0 end-0">
                                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal_{{ game.id }}">详情</button>
                                            </div>
                                        </div>
                                        <div class="overflow-hidden" style="width: 140px; height: 180px;">
                                            <img src="{{ url_for('static', filename='image/' ~ game.theme) }}" alt="" class="h-100 w-100 object-fit-cover">
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade text-start" id="modal_{{ game.id }}" tabindex="-1" aria-labelledby="myModalLabel" style="display: none;" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="myModalLabel">{{ game.name }}</h5>
                                                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="card-body p-4">
                                                <strong>规则：</strong><br>{{ game.rule }}<br><br>
                                                <strong>背景介绍：</strong><br>{{ game.description }}<br><br>
                                                <strong>QQ：</strong>{{ game.qq }}<br><br>
                                                <strong>跑团桌位：</strong>{{ game.table }}
                                            </div>
                                            <div class="modal-footer">
												{% if game.id in enrolled_game %}
												<a class="btn btn-primary" style="display: block;" href="{{ url_for('remove_player', game_id=game.id) }}" onclick="return handleGameAction(this)">取消报名</a>
												<a class="btn btn-primary" style="display: none;" href="{{ url_for('add_player', game_id=game.id) }}" onclick="return handleGameAction(this)">报名</a>
												{% else %}
												<a class="btn btn-primary" style="display: none;" href="{{ url_for('remove_player', game_id=game.id) }}" onclick="return handleGameAction(this)">取消报名</a>
												<a class="btn btn-primary" style="display: block;" href="{{ url_for('add_player', game_id=game.id) }}" onclick="return handleGameAction(this)">报名</a>
												{% endif %}
											</div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </details>
                    <details style="text-align: left;" open="">
                        <summary style="line-height:3em;">下半场</summary>
                        <div class="row">
                            {% for game in day2_gamesB %}
                                <div class="equal-height h-auto mb-3 col-xl-6 bg-white p-4 position-relative">
                                    <div class="row">
                                        <div style="width: calc(100% - 140px);" class="position-relative">
                                            <div class="text-lg position-absolute top-0 end-0 opacity-25 text-gray-500" id="signed_{{ game.id }}" style="transform: rotate(20deg);display: none;">
                                                <strong>已报名</strong>
                                            </div>
                                            <p class="mb-2 text-gray-500 text-start">
                                                <strong style="font-size: 1.5rem;" class="text-primary">【{{ game.rule }}】{{ game.name }}</strong><br>
                                                <strong>主持：</strong>{{ game.kp }}<br>
                                                <strong>场次：</strong>下半场<br>
                                            </p>
                                            <p class="mb-0 text-gray-500 text-start">
                                                剩余空位：<strong class="text-primary text-lg">{{ game.max_pl-space_reserved[game.id] }}</strong>
                                            </p>
                                            <div class="position-absolute bottom-0 end-0">
                                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal_{{ game.id }}">详情</button>
                                            </div>
                                        </div>
                                        <div class="overflow-hidden" style="width: 140px; height: 180px;">
                                            <img src="{{ url_for('static', filename='image/' ~ game.theme) }}" alt="" class="h-100 w-100 object-fit-cover">
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade text-start" id="modal_{{ game.id }}" tabindex="-1" aria-labelledby="myModalLabel" style="display: none;" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="myModalLabel">{{ game.name }}</h5>
                                                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="card-body p-4">
                                                <strong>规则：</strong><br>{{ game.rule }}<br><br>
                                                <strong>背景介绍：</strong><br>{{ game.description }}<br><br>
                                                <strong>QQ：</strong>{{ game.qq }}<br><br>
                                                <strong>跑团桌位：</strong>{{ game.table }}
                                            </div>
                                            <div class="modal-footer">
												{% if game.id in enrolled_game %}
												<a class="btn btn-primary" style="display: block;" href="{{ url_for('remove_player', game_id=game.id) }}" onclick="return handleGameAction(this)">取消报名</a>
												<a class="btn btn-primary" style="display: none;" href="{{ url_for('add_player', game_id=game.id) }}" onclick="return handleGameAction(this)">报名</a>
												{% else %}
												<a class="btn btn-primary" style="display: none;" href="{{ url_for('remove_player', game_id=game.id) }}" onclick="return handleGameAction(this)">取消报名</a>
												<a class="btn btn-primary" style="display: block;" href="{{ url_for('add_player', game_id=game.id) }}" onclick="return handleGameAction(this)">报名</a>
												{% endif %}
											</div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </details>
                </div>
            </div>
        </div>
    </div>
</section>


<!-- <div id="map">
	<iframe frameborder="0" width="100%" height="100%" style="border: 0;"
		src="http://apis.map.qq.com/tools/poimarker?type=0&marker=coord:29.550457,106.51751;title:幻想共振-Coptus;addr:重庆化龙桥印象城六楼Coptus|coord:29.550457,106.517512&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77&referer=myapp"></iframe>
</div> -->
<footer class="py-5 bg-dark text-light">
	<div class="container py-3">
		<div class="row gy-3 mb-4 text-center align-items-center">
			<div class="col-md-6 text-lg-start">
				<!-- <ul class="list-inline">
					<li class="list-inline-item"><a class="social-link facebook" href="#"> <i
								class="fab fa-facebook-f"></i></a></li>
					<li class="list-inline-item"><a class="social-link instagram" href="#"> <i
								class="fab fa-instagram"></i></a></li>
					<li class="list-inline-item"><a class="social-link pinterest" href="#"> <i
								class="fab fa-pinterest"></i></a></li>
					<li class="list-inline-item"><a class="social-link email" href="#"> <i
								class="fas fa-envelope"></i></a></li>
				</ul> -->
			</div>
		</div>
	</div>
</footer>
<!-- 通知 -->
<div class="toast-container position-fixed top-0 end-0 p-4">
    <div class="toast fade hide" role="alert" aria-live="assertive" aria-atomic="true" id="msgbox">
        <div class="toast-header"><strong class="me-auto">提示</strong>
            <button class="btn-close" type="button" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body"></div>  <!-- Empty content -->
    </div>
</div>



<script src="{{ url_for('static', filename="js/home-premium.js") }}"> </script>
<!-- JavaScript files-->
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.1/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/1.8.2/countUp.min.js"></script>
<script src="{{ url_for('static', filename='vendor/universal-parallax/universal-parallax.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/theme.js') }}"></script>


<script>
	//dynamic changes with respect to login status
	function loadBlock() {
		fetch('/get_block')
		.then(res => res.json())
		.then(data => {
			document.getElementById('dynamic-content').innerHTML = data.html;
			const login_form = document.getElementById('login-form');
			if (login_form) {
				login_form.addEventListener('submit', (e) => {
					e.preventDefault();

					// Get form inputs
					const username = login_form.querySelector('input[name="username"]').value;
					const password = login_form.querySelector('input[name="password"]').value;

					if (username && password) {
						fetch('/login', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify({username, password}),
						})
						.then(res => res.json())
						.then(data => {
							if (data.success) {
								console.log("Login successful, reloading page");
								// CHANGE: Reload the entire page instead of just updating the dynamic content
								window.location.reload();
							} else {
								console.log("Login failed");
								// Show error message
								creatMsg("提示", "密码错误！", "danger");
							}
						})
						.catch(err => {
							console.error("Login error:", err);
							creatMsg("提示", "登录请求失败，请重试", "warning");
						});
					}
				});
			}
		})
		.catch(err => {
			console.error("Error loading block:", err);
		});
	}




	function logout() {
		fetch('/logout')
		.then(res => res.json())
		.then(data => {
			console.log("Logout successful");
			// Reload the entire page
			window.location.reload();
		})
		.catch(err => {
			console.error("Logout error:", err);
		});
	}

	window.onload = loadBlock;
</script>



<script>
	// post请求+msg
	function post(e, func1 = null, func2 = null) {
		var url = e.href;
		// 发送post
		var xhr = new XMLHttpRequest();
		xhr.open("POST", url, true);
		xhr.setRequestHeader("Content-Type", "application/json");
		xhr.send();
		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4 && xhr.status == 200) {
				var msg = JSON.parse(xhr.responseText);
				if (msg[0]) {
					creatMsg("成功", msg[1], "success");
					if (func1) func1();
					return true;
				} else {
					creatMsg("错误", msg[1], "danger");
					if (func2) func2();
					return false;
				}
			} else {
				creatMsg("提示", "与服务器通信发生错误", "warning");
				return false;
			}
		};
	}

	// 创建通知信息
	function creatMsg(title, text, type = null) {
		msgbox.children[0].children[0].innerText = title;
		msgbox.children[1].innerText = text;
		// 移除组
		msgbox.classList.remove("bg-danger", "bg-success", "bg-warning", "text-white");
		// 添加组
		if (type == "success") {
			msgbox.classList.add("bg-success", "text-white");
		} else
		if (type == "danger") {
			msgbox.classList.add("bg-danger", "text-white");
		} else
		if (type == "warning") {
			msgbox.classList.add("bg-warning", "text-white");
		}
		var toastElList = [].slice.call(document.querySelectorAll('.toast'))
		var toastList = toastElList.map(function(toastEl) {
			return new bootstrap.Toast(toastEl)
		})
		toastList.forEach(toast => toast.show())
	}
	// 为了使网页不报错
	function Swiper() {}

	function mixitup() {}

	function Waypoint() {}
</script>

<script>
    // Mark enrolled games
    document.addEventListener('DOMContentLoaded', function() {
        // Make sure to use safe filter to prevent escaping
        const enrolledGames = {{ enrolled_js|safe }};

        console.log("Enrolled games:", enrolledGames);

        // Mark each enrolled game
        enrolledGames.forEach(gameId => {
            const signedElement = document.getElementById(`signed_${gameId}`);
            if (signedElement) {
                console.log(`Marking game ${gameId} as enrolled`);
                signedElement.style.display = 'block';
            }

            // Update join/leave buttons visibility if needed
            const joinBtn = document.querySelector(`a[href="{{ url_for('add_player', game_id='') }}${gameId}"]`);
            const leaveBtn = document.querySelector(`a[href="{{ url_for('remove_player', game_id='') }}${gameId}"]`);

            if (joinBtn) joinBtn.style.display = 'none';
            if (leaveBtn) leaveBtn.style.display = 'block';
        });
    });
</script>

<script>
    // Initialize tabs on page load
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Page loaded, initializing tabs");

        // Initialize Bootstrap tabs
        var tabElms = document.querySelectorAll('#myTab button[data-bs-toggle="tab"]');
        tabElms.forEach(function(tabElm) {
            tabElm.addEventListener('click', function(event) {
                event.preventDefault();
                var tabTarget = document.querySelector(this.dataset.bsTarget);

                // Hide all tabs
                document.querySelectorAll('.tab-pane').forEach(function(pane) {
                    pane.classList.remove('show', 'active');
                });

                // Show this tab
                tabTarget.classList.add('show', 'active');

                // Update active state on buttons
                document.querySelectorAll('#myTab button').forEach(function(btn) {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-selected', 'false');
                });

                this.classList.add('active');
                this.setAttribute('aria-selected', 'true');

                console.log("Tab activated:", this.id);
            });
        });

        // Mark enrolled games
        const enrolledGames = {{ enrolled_js|safe }};
        console.log("Enrolled games:", enrolledGames);

        // Mark each enrolled game
        enrolledGames.forEach(gameId => {
            const signedElement = document.getElementById(`signed_${gameId}`);
            if (signedElement) {
                console.log(`Marking game ${gameId} as enrolled`);
                signedElement.style.display = 'block';
            }
        });

        // Make sure the active tab is shown by default
        const activeTabBtn = document.querySelector('#myTab button.active');
        if (activeTabBtn) {
            console.log("Activating default tab:", activeTabBtn.id);
            activeTabBtn.click();
        }
    });

    // Rest of your existing scripts...
</script>

<script>
    function handleGameAction(link) {
		// Important: prevent default action first
		event.preventDefault();

		console.log('handleGameAction called for', link.href);

		fetch(link.href)
		.then(response => {
			console.log('Response received:', response);
			return response.json();
		})
		.then(data => {
			console.log('Data received:', data);
			if (data.message) {
				creatMsg("成功", data.message, "success");
				// Reload the page to refresh game status after a short delay
				console.log('Reloading page in 1 second...');
				setTimeout(() => window.location.reload(), 1000);
			} else if (data.error) {
				creatMsg("错误", data.error, "danger");
			}
		})
		.catch(error => {
			console.error('Error:', error);
			creatMsg("提示", "与服务器通信发生错误", "warning");
		});

		return false; // Prevent the link from being followed
	}
</script>

<!-- FontAwesome CSS - loading as last, so it doesn't block rendering-->
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css"
	integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
{% endblock %}
